import{c as h,u as V,b as q,a as F,r as n,g as O,j as e,L as I}from"./index-B8S532Nu.js";import{c as B,d as A,p as L}from"./usePosts-DJuT0Ftm.js";import{s as K}from"./slugify-B7NNvCz2.js";import{C as X,a as Y}from"./circle-x-CoO-joAO.js";const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Q=h("circle-check",J);const W=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Z=h("download",W);const ee=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],te=h("image",ee);const se=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],ae=h("link",se);const re=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],le=h("star",re),me=()=>{const{id:i}=V(),f=q(),{data:S=[]}=F(),M=B(),U=A(),[p,j]=n.useState({message:null,type:null}),m=(t,a="success")=>{j({message:t,type:a}),setTimeout(()=>j({message:null,type:null}),3e3)},[s,c]=n.useState({title:"",excerpt:"",slug:"",content:"",category_id:1,author:"ThongDev",image:null,type:"html",toc:"",status:"published",is_featured:!1,featured_order:""}),[d,P]=n.useState(""),[v,z]=n.useState(null),[N,b]=n.useState(""),[y,C]=n.useState(!1),[w,k]=n.useState(!1),[D,G]=n.useState({content:"",toc:""}),[H,$]=n.useState({content:"",toc:""});n.useEffect(()=>{i&&L.getById(i).then(t=>{if(!t)throw new Error("Invalid response: missing data");c({...t,excerpt:t.excerpt||"",author:t.author||"",toc:t.toc||"",is_featured:!!t.is_featured,featured_order:t.featured_order?String(t.featured_order):"",status:t.status||"published",image:null}),t.image&&b(O(t.image))}).catch(t=>{console.error("Error loading post:",t),m(`Không thể tải bài viết: ${t.message}`,"error"),setTimeout(()=>f("/"),2e3)})},[i,f]);const R=async()=>{if(!d)return m("Vui lòng dán link Markdown (.md)","error");k(!0);const t=d.includes("github.com");let a=d,l="";t&&(a=d.replace("github.com","raw.githubusercontent.com").replace("/blob/","/"),l=d.replace("github.com","raw.githubusercontent.com").replace("/blob/","/"),l=l.substring(0,l.lastIndexOf("/")+1));try{let r=await L.importFromUrl(a);t&&(r=r.replace(/!\[([^\]]*)\]\((?!http|https)([^)]+)\)/g,(g,x,u)=>{const T=u.replace(/^\.\//,"");return`![${x}](${l}${T}?raw=true)`})),r=r.replace(/\[([^\]]+)\]\(#([^\)]+)\)/g,(g,x,u)=>`[${x}](#${K(u)})`);let o="";const _=r.match(/##\s*Mục lục[\s\S]*?(?=\n---)/i);_&&(o=_[0].split(`
`).filter(u=>u.match(/^##\s*Mục lục/i)?!0:(u.match(/^(\s*)/)?.[1]?.length||0)<4).join(`
`).trim(),r=r.replace(/##\s*Mục lục[\s\S]*?\n---\n?/i,"").trim()),c(g=>({...g,content:r,toc:o,type:"markdown"})),m("Nhập Markdown thành công!","success")}catch(r){m("Lỗi Import: "+r.message,"error")}finally{k(!1)}},E=async t=>{t.preventDefault(),C(!0);const a=new FormData;Object.keys(s).forEach(l=>{if(l!=="image"){const r=l;let o=s[r];l==="is_featured"&&(o=s[r]?1:0),l==="toc"&&s.type==="html"&&(o=""),o!=null&&a.append(l,String(o))}}),v&&a.append("image",v),i&&a.append("_method","PUT");try{i?(await U.mutateAsync({id:i,formData:a}),m("Cập nhật bài viết thành công!")):(await M.mutateAsync(a),m("Lưu bài viết mới thành công!")),setTimeout(()=>f("/"),1e3)}catch(l){console.error(l),m(l.message,"error")}finally{C(!1)}};return e.jsxs("div",{className:"editor-container animate-fade",children:[p.message&&e.jsx("div",{className:"toast-container",children:e.jsxs("div",{className:`toast toast-${p.type}`,children:[p.type==="success"?e.jsx(X,{size:20}):e.jsx(Y,{size:20}),e.jsx("span",{children:p.message})]})}),e.jsxs("form",{onSubmit:E,children:[e.jsx("h2",{className:"editor-header",children:i?"Cập nhật bài viết":"Viết bài mới"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"TIÊU ĐỀ"}),e.jsx("input",{className:"form-input",value:s.title,onChange:t=>c({...s,title:t.target.value}),required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"SLUG (URL TĨNH)"}),e.jsx("input",{className:"form-input",value:s.slug,onChange:t=>c({...s,slug:t.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"ĐỊNH DẠNG NỘI DUNG"}),e.jsxs("select",{className:"form-select",value:s.type,onChange:t=>{const a=t.target.value;s.type==="html"?G({content:s.content,toc:s.toc}):$({content:s.content,toc:s.toc});const r=a==="html"?D:H;c({...s,type:a,content:r.content,toc:r.toc})},children:[e.jsx("option",{value:"html",children:"HTML"}),e.jsx("option",{value:"markdown",children:"Markdown"})]})]})]}),e.jsxs("div",{className:"featured-config-card",children:[e.jsxs("label",{className:"featured-checkbox-wrapper",children:[e.jsx("input",{type:"checkbox",checked:s.is_featured,onChange:t=>c({...s,is_featured:t.target.checked})}),e.jsxs("div",{className:"checkbox-custom-content",children:[e.jsx(le,{size:18,fill:s.is_featured?"#b45309":"none",color:"#b45309"}),e.jsx("span",{children:"Đặt làm bài viết Tiêu điểm (Featured Grid)"})]})]}),s.is_featured&&e.jsxs("div",{className:"featured-options animate-slide-down",children:[e.jsx("label",{className:"form-label mini",children:"VỊ TRÍ HIỂN THỊ"}),e.jsxs("select",{className:"form-select",value:s.featured_order,onChange:t=>c({...s,featured_order:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"-- Chọn vị trí --"}),e.jsx("option",{value:"1",children:"Vị trí 1 (Lớn nhất)"}),e.jsx("option",{value:"2",children:"Vị trí 2 (Nhỏ trên)"}),e.jsx("option",{value:"3",children:"Vị trí 3 (Nhỏ dưới)"})]})]})]}),e.jsxs("div",{className:"import-github-card",children:[e.jsxs("label",{className:"form-label mini",children:[e.jsx(ae,{size:14,className:"inline mr-1"})," IMPORT TỪ URL"]}),e.jsxs("div",{className:"import-controls",children:[e.jsx("input",{type:"text",className:"form-input",placeholder:"Paste Markdown link (GitHub, raw URL, etc.)",value:d,onChange:t=>P(t.target.value)}),e.jsxs("button",{type:"button",onClick:R,disabled:w,className:"btn-import",children:[w?e.jsx(I,{className:"spin",size:16}):e.jsx(Z,{size:16}),e.jsx("span",{children:"Import"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CHUYÊN MỤC"}),e.jsx("select",{className:"form-select",value:s.category_id,onChange:t=>c({...s,category_id:parseInt(t.target.value)}),children:S.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"TÁC GIẢ"}),e.jsx("input",{className:"form-input",value:s.author,onChange:t=>c({...s,author:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"TRẠNG THÁI"}),e.jsxs("select",{className:"form-select",value:s.status,onChange:t=>c({...s,status:t.target.value}),children:[e.jsx("option",{value:"published",children:"Công khai"}),e.jsx("option",{value:"draft",children:"Bản nháp"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"MÔ TẢ NGẮN (EXCERPT)"}),e.jsx("textarea",{className:"form-textarea",value:s.excerpt,onChange:t=>c({...s,excerpt:t.target.value}),rows:3})]}),e.jsxs("div",{className:"image-upload-section",children:[e.jsx("label",{className:"form-label",children:"ẢNH ĐẠI DIỆN"}),e.jsx("div",{className:"image-preview-box",children:N?e.jsx("img",{src:N,alt:"Preview",className:"preview-img"}):e.jsxs("div",{className:"preview-placeholder",children:[e.jsx(te,{size:32}),e.jsx("span",{children:"Chưa chọn ảnh"})]})}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>{const a=t.target.files?.[0];a&&(z(a),b(URL.createObjectURL(a)))}})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",children:["NỘI DUNG (",s.type.toUpperCase(),")"]}),e.jsx("textarea",{className:"form-textarea content-editor",value:s.content,onChange:t=>c({...s,content:t.target.value}),required:!0})]}),s.type==="markdown"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"MỤC LỤC (TOC)"}),e.jsx("textarea",{className:"form-textarea toc-editor",value:s.toc,onChange:t=>c({...s,toc:t.target.value})})]}),e.jsxs("button",{type:"submit",className:"btn-save-post",disabled:y,children:[y?e.jsx(I,{className:"spin",size:20}):e.jsx(Q,{size:20}),e.jsx("span",{children:i?"Cập nhật bài viết":"Lưu bài viết mới"})]})]})]})};export{me as default};
